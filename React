import React, { useState, useRef } from 'react';
import "../index.css";
import "./tree.css"
import MenuIcon from '@mui/icons-material/Menu';
import ArrowForwardIcon from '@mui/icons-material/ArrowForward';
import CloseIcon from '@mui/icons-material/Close';
import { CardContent } from '@mui/material';
import { FlareSharp } from '@mui/icons-material';

function Pricemodel() {
  const boxStyle = {
    border: '1px solid #000', // Add a border around the text
    padding: '2px', // Add some padding for spacing
    display: 'inline-block',
     
    // Make sure the box doesn't take the full width
  };
 const sidebarRef = useRef(null);
 const boxContainerRef = useRef(null); // Added ref for the box container
 const [isResizing, setIsResizing] = useState(false);
 const [sidebarWidth, setSidebarWidth] = useState(261);

 const costsidebarRef = useRef(null);
 const minSidebarWidthWithText = 100;
 const [isCostPanelresizing, setIsCostPanelresizing] = useState(false);
 const [costPanelWidth, setCostPanelWidth] = useState(300);
 const minCostPanelWidth = 50;

 const bottomsidebarRef = useRef(null);
 
 
 const [isBottomPanelresizing, setIsBottomPanelresizing] = useState(false);
 const [BottomPanelheight, setBottomPanelheight] = useState(145); // Corrected variable name
 const minBottomPanelheight = 100; // Corrected variable name
 const [isCollapsed,setIsCollapsed]=useState(false);
 const [isFormulaBarVisible, setFormulaBarVisible] = useState(false);
 const [isReferenceVisible, setReferenceVisible] = useState(false);
 const [isBottomSidebarOpen, setBottomSidebarOpen] = useState(true);
 const [isOpen,setIsOpen]=useState(true);

 const showFormulaBar = () => {
  setFormulaBarVisible(true);
  setReferenceVisible(false);
  setBottomSidebarOpen(true);
};

const showReference = () => {
  setFormulaBarVisible(false);
  setReferenceVisible(true);
  setBottomSidebarOpen(true);
};

const closeBottomSidebar = () => {
  setBottomSidebarOpen(false);
};
const openbottombar=()=>{
  setIsOpen(true);
}
 
 
 const startResizing = React.useCallback((mouseDownEvent) => {
  setIsResizing(true);
 }, []);

 const startCostPanelResizing =React.useCallback( (mouseDownEvent) => {
  setIsCostPanelresizing(true);
 },[]);

 const stopResizing = React.useCallback(() => {
  setIsResizing(false);
 }, []);

 const stopCostPanelResizing = React.useCallback(() => {
  setIsCostPanelresizing(false);
 },[]);


 const togglesidePanel = () => {
    if (sidebarWidth <= minSidebarWidthWithText) {
      // If the sidebar is at the minimum width, expand it
      setSidebarWidth(261); // Set the desired width when expanded
    } else {
      setIsCollapsed(!isCollapsed);
    }
  };
  const togglesidePanelclose = () => {
    if (sidebarWidth > minSidebarWidthWithText) {
      // If the sidebar is at the minimum width, expand it
      setSidebarWidth(50); // Set the desired width when expanded
    } else {
      setIsCollapsed(isCollapsed);
    }
  };
  const toggleCostPanel = () => {
    if (costPanelWidth <= minCostPanelWidth) {
      // If the cost sidebar is at the minimum width, expand it
      setCostPanelWidth(300); // Set the desired width when expanded
    } else {
      setIsCostPanelresizing(!isCostPanelresizing);
    }
  };
  const togglecostPanelclose = () => {
    if (costPanelWidth > minCostPanelWidth) {
      // If the sidebar is at the minimum width, expand it
      setCostPanelWidth(50); // Set the desired width when expanded
    } else {
        setIsCostPanelresizing(isCostPanelresizing);
    }
}

const startBottomPanelResizing = (mouseDownEvent) => {
    setIsBottomPanelresizing({
      initialHeight: BottomPanelheight,
      mouseY: mouseDownEvent.clientY,
    });
  };
  
  const stopBottomPanelResizing = () => {
    setIsBottomPanelresizing(false);
  };
  
  const toggleBottomPanel = () => {
    if (BottomPanelheight <= minBottomPanelheight) {
      setBottomPanelheight(300); // Set the desired maximum height when expanded
    } else {
      setBottomPanelheight(minBottomPanelheight); // Set the minimum height when collapsed
    }
  };

   
  const toggleBottomPanelclose = () => {
    if (BottomPanelheight > minBottomPanelheight) {
      // If the sidebar is at the minimum width, expand it
      setBottomPanelheight(50); // Set the desired width when expanded
    } else {
        setIsBottomPanelresizing(isBottomPanelresizing);
    }
}
  

 const resize = React.useCallback(
  (mouseMoveEvent) => {
   if (isResizing) {
    const newWidth =
     mouseMoveEvent.clientX -
     sidebarRef.current.getBoundingClientRect().left;
    setSidebarWidth(newWidth);
    
   }
  },
  [isResizing]
 );
 const costresize = React.useCallback(
    (mouseMoveEvent) => {
      if (isCostPanelresizing) {
        const newWidth =
          costsidebarRef.current.getBoundingClientRect().right - mouseMoveEvent.clientX;
       
          setCostPanelWidth(newWidth);
        
      }
    },
    [isCostPanelresizing]
  );

  const bottomresize = (mouseMoveEvent) => {
    if (isBottomPanelresizing) {
      const mouseX = mouseMoveEvent.clientX;
      const initialX = isBottomPanelresizing.mouseX;
      const deltaX = mouseX - initialX;

      let newWidth = isBottomPanelresizing.initialWidth + deltaX;

      // Ensure the new width doesn't go below the minimum or above the maximum
      newWidth = Math.max(minBottomPanelheight, newWidth);
      newWidth = Math.min(200, newWidth); // Set the maximum width as needed

      setBottomPanelheight(newWidth);
    }
  };
  
  
  
  
  
  

 

 

 
 
 
 

 React.useEffect(() => {
  window.addEventListener("mousemove", resize);
  window.addEventListener("mouseup", stopResizing);
  return () => {
   window.removeEventListener("mousemove", resize);
   window.removeEventListener("mouseup", stopResizing);
  };
 }, [resize, stopResizing]);

 
 React.useEffect(() => {
  window.addEventListener("mousemove", costresize);
  window.addEventListener("mouseup", stopCostPanelResizing);
  return () => {
   window.removeEventListener("mousemove",costresize);
   window.removeEventListener("mouseup", stopCostPanelResizing);
  };
 }, [costresize, stopCostPanelResizing]);

 React.useEffect(() => {
    window.addEventListener("mousemove", bottomresize);
    window.addEventListener("mouseup", stopBottomPanelResizing);
  
    return () => {
      window.removeEventListener("mousemove", bottomresize);
      window.removeEventListener("mouseup", stopBottomPanelResizing);
    };
  }, []);
 

 return (
   <div className="app-container">
   <div
    ref={sidebarRef}
    className={`app-sidebar ${isCollapsed?'collapsed':``}`}
    style={{ width: sidebarWidth }}
    onMouseDown={(e) => e.preventDefault()}
   >
    <div className="app-sidebar-content">
     <div
      className='logotext'
      style={{ textAlign: 'center', marginLeft: sidebarWidth > minSidebarWidthWithText ? "6px" : "10px" }}
     >
      {sidebarWidth > minSidebarWidthWithText || isResizing || isCollapsed? (
       <div
        className="heading-box mt-1"
        style={{
         display: 'flex',
         alignItems: 'center',
         width: { sidebarWidth },
         position: "relative",
         background: "linear-gradient(90deg,rgb(50,30,100) 20%,rgb(0,0,0) 100%",
        }}
       >
        <MenuIcon style={{ marginRight: '10px', color: "white" }} onClick={togglesidePanelclose}/>
        <h6 className="mt-2" style={{ marginLeft: "10px", color: "White" }}>Price Model</h6>
       </div>
      ) : (
       <MenuIcon onClick={togglesidePanel}/>)
      }


     </div>
     
     
    </div>
    <div className="app-sidebar-resizer" onMouseDown={startResizing} />
   </div>
   
   <div className="app-frame">
   <div  className="centered-text">
         <h1>Price Model-Workbench</h1>
         </div>
       <div  className='tree'>
      <ul>
        <li> 
          <div style={boxStyle} className='centered-text'><h5>Price Model Header/ Total Invoice Price </h5></div>
        
        <ul>
        
          <li> <div style={boxStyle} >Total material</div>
            <ul>
              <li><div style={boxStyle} > Raw material</div></li>
              <li><div style={boxStyle}>Packaging</div></li>
            </ul>
          </li>
          <li> <div style={boxStyle}>Conversion and Fees</div>
            <ul>
              <li><div style={boxStyle}> Manufacturing</div></li>
              <li><div style={boxStyle}> Labor</div></li>
              <li><div style={boxStyle}> Fees</div></li>
            </ul>
          </li>
          <li> <div style={boxStyle}>Logistics</div> 
            <ul>
              <li><div style={boxStyle}> Transportation</div></li>
              <li><div style={boxStyle}>Warehousing</div></li>
            </ul>
          </li>
         
         
        </ul>
        </li>
        </ul>
       </div>
   
    {isBottomSidebarOpen&&(
 
    <div
        ref={bottomsidebarRef}
        className={`bottom-app-sidebar vertical ${isCollapsed ? 'collapsed' : ''}`}
        style={{ height: BottomPanelheight ,width:"650px"}}
        onMouseDown={(e) => e.preventDefault()}
      >
        
       
        <div className="bottom-app-sidebar-content">
          <div className='bottom-box' style={{height:"30px",width:"800px",display:"flex"}}>
            <h6 style={{color:"white"}} onClick={showFormulaBar}>Formula Bar</h6>
            <h6 style={{color:"white",marginLeft:"20px"}} onClick={showReference}>Reference Material</h6>
        <CloseIcon style={{marginLeft:"350px",color:"white"}} onClick={closeBottomSidebar}/>

            </div>

            {isFormulaBarVisible && (
        <div className="text-center mt-1">
          <h6 style={{ alignItems: "center", color: "black" }}>Formula Bar</h6>
          <h6>
            <i>ability to modify formula of child elements</i>
          </h6>
          <h6>Raw Materials = Sum of (Feedstock 1, Feedstock 2, ...)</h6>
        </div>
      )}

        {isReferenceVisible&&(<div className='text-center mt-1'> <h6 style={{alighItem:"center",color: "black"}} >
            Reference Material(92154554)
           </h6>
           <h6>
           <i>slow current calculation based on selected element</i> 
           </h6>
           <h6>Raw Material Cost=Sum of(Feedstock 1(3.5), Feedstock 2(5.0))</h6>
           </div>)}
           

         
        </div>
      </div>
      )}
      </div>
   
     



   <div
    ref={costsidebarRef}
    className="right-app-sidebar"
    style={{ width:costPanelWidth}}
    onMouseDown={(e) => e.preventDefault()}
   >
     <div className="right-app-sidebar-resizer" onMouseDown={startCostPanelResizing} />
    <div className="right-app-sidebar-content">
     <div
      className='logotext'
      style={{ textAlign: 'center', marginRight: costPanelWidth > minCostPanelWidth ? "6px" : "10px" }}
     >
      {costPanelWidth>minCostPanelWidth || isCostPanelresizing ? (
       <div
        className="right-heading-box mt-1"
        style={{
         display: 'flex',
         alignItems: 'center',
         width: { costPanelWidth },
         position: "relative",
         background: "linear-gradient(90deg,rgb(50,30,100) 20%,rgb(0,0,0) 100%",
        }}
       >
        <MenuIcon style={{ marginRight: '10px', color: "white" }} onClick={togglecostPanelclose}/>
        <h6 className="mt-2" style={{ marginRight: "10px", color: "White" }}>Costing Panel</h6>
       </div>
      ) : (
        
          <MenuIcon onClick={toggleCostPanel}/>
          )
      }
     </div>
     
     
    </div>
    
   </div>
   
  
    


   </div>
  
 );
}

export default Pricemodel;

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

.app-container {
  min-height: 100vh;
  padding: 1em 1em;
  display: flex;
  flex-direction: row;
  height: 100vh;
}

.app-sidebar {
  flex-grow: 0;
  flex-shrink: 0;
  min-width: 50px;
  max-width: 300px;
  display: flex;
  border-right: 1px solid #e9e9e9;
  flex-direction: row;
  background: #ffffff;
  box-shadow: -8px 2px 22px -7px rgba(0, 0, 0, 0.25);
  border-radius: 10px 0px 0px 10px;
  z-index: 2;
  overflow: hidden;
  position: "relative"
}

.app-frame {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  height: 100vh;
  max-height: 100%;
  background: #ffffff;
  box-shadow: 8px 2px 32px -2px rgba(0, 0, 0, 0.25);
 
  z-index: 1;
}

.app-sidebar .app-sidebar-content {
  flex: 1;
  overflow: hidden;
  position: "relative"
}

.app-sidebar .app-sidebar-resizer {
  flex-grow: 0;
  flex-shrink: 0;
  flex-basis: 6px;
  justify-self: flex-end;
  cursor: col-resize;
  resize: horizontal;
  overflow: hidden;
  position: "relative"
}

.app-sidebar .app-sidebar-resizer:hover {
  width: 3px;
  background: #c1c3c5b4;
  overflow: hidden;
  position: "relative"
}

.heading-box {
  background-color: #f2f2f2;
  padding: 8px;
  overflow: hidden;
  height:"10px";
  width:"100px"
 }

.boxContainerRef {
  position: absolute;
  left: 261px;
  width: calc(100% - 261px);
  max-width: 100%;
}
.right-app-sidebar {
  flex-grow: 0;
  flex-shrink: 0;
  min-width: 50px;
  max-width: 300px;
  display: flex;
  border-right: 1px solid #e9e9e9;
  flex-direction: row;
  background: #ffffff;
  box-shadow: -8px 2px 22px -7px rgba(0, 0, 0, 0.25);
  border-radius: 0px 10px 10px 0px;
  z-index: 2;
  overflow: hidden;
  padding-right: 20px;
 
}

.right-app-sidebar .right-app-sidebar-content {
  flex: 1;
  overflow: hidden;
  position: "relative"
}

.right-app-sidebar .right-app-sidebar-resizer {
  flex-grow: 0;
  flex-shrink: 0;
  flex-basis: 6px;
  justify-self: flex-end;
  cursor: col-resize;
  resize: horizontal;
  overflow: hidden;
  position: "relative"
  
}

.right-app-sidebar .right-app-sidebar-resizer:hover {
  width: 3px;
  background: #c1c3c5b4;
  
  
}
.right-heading-box {
  background-color: #f2f2f2;
  padding: 8px;
  overflow: hidden;
  height:"10px";
  width:"100px"
 }

 .bottom-app-sidebar {
  flex-grow: 1; /* Grow horizontally */
  flex-shrink: 0;
  min-height: 50px; /* Adjust the height as needed */
  max-height: 200px; /* Adjust the maximum height as needed */
  
  flex-direction: column; /* Set the direction to horizontal */
  background: #ffffff;
  box-shadow: 2px 8px 22px -7px rgba(0, 0, 0, 0.25); 
  border-radius: 0px 0px 0px 0px;/* Update shadow */
 
 
  overflow: hidden;
  position: "relative";
  margin-top: 63px;
  background-color: cadetblue;
}

.bottom-app-sidebar .bottom-app-sidebar-content {
  flex: 1;
 

  overflow: hidden;
  position: "relative";
 
}

.bottom-app-sidebar .bottom-app-sidebar-resizer {
  flex-grow: 0;
  flex-shrink: 0;
  flex-basis: 6px;
  cursor: ns-resize; /* Use "ns-resize" to make it resize vertically */
  position: relative;
  margin-top: -3px; /* Adjust this value as needed to position it correctly at the top */
  margin-left: auto;
  margin-right: auto;
  overflow: hidden;
}





.bottom-right-app-sidebar .bottom-right-app-sidebar-resizer:hover {
  width: 3px;
  background: #c1c3c5b4;
  
  
}

.bottom-box {
  background-color: #0e0d0d;
  padding: 4px;
  overflow: hidden;
  
  
 
 }







 




.bottom-app-sidebar .bottom-app-sidebar-resizer:hover {
  width: 3px;
  background: #c1c3c5b4;
  
  
}
